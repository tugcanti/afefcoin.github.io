<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AFEF Token — The Professional Platform</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Auth0 Kütüphanesi -->
    <script src="https://cdn.auth0.com/js/auth0/9.20.0/auth0.min.js"></script>
    
    <!-- YENİ: Firebase Kütüphaneleri -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <style>
        :root { --bg-dark: #10162F; --card-dark: #192040; --text-main: #FFFFFF; --text-muted: #A0AEC0; --accent-purple: #6A35FF; --accent-pink: #E43A8A; --border-color: rgba(255, 255, 255, 0.1); }
        html { scroll-behavior: smooth; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-dark); color: var(--text-main); }
        h1, h2, h3, h4, h5, h6 { font-family: 'Poppins', sans-serif; }
        .auth0-card { background-color: var(--card-dark); border: 1px solid var(--border-color); border-radius: 0.75rem; box-shadow: 0 10px 30px rgba(0,0,0,0.2); transition: all 0.3s ease-in-out; }
        .btn-primary { background: linear-gradient(90deg, var(--accent-purple), var(--accent-pink)); color: var(--text-main); font-weight: 600; border-radius: 0.5rem; transition: all 0.3s ease-in-out; box-shadow: 0 4px 15px rgba(106, 53, 255, 0.3); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(106, 53, 255, 0.4); }
        .btn-primary:disabled { background: #555; cursor: not-allowed; box-shadow: none; transform: none; }
        .btn-secondary { background-color: rgba(255,255,255,0.05); color: var(--text-main); font-weight: 600; border-radius: 0.5rem; border: 1px solid var(--border-color); transition: all 0.3s ease-in-out; }
        .btn-secondary:hover { background-color: var(--border-color); }
        #hamburger-btn { width: 24px; height: 24px; position: relative; }
        #hamburger-btn span { display: block; width: 100%; height: 2px; background-color: var(--text-main); border-radius: 2px; position: absolute; transition: all 0.3s ease-in-out; }
        #hamburger-btn span:nth-child(1) { top: 4px; } #hamburger-btn span:nth-child(2) { top: 11px; } #hamburger-btn span:nth-child(3) { top: 18px; }
        #hamburger-btn.open span:nth-child(1) { top: 11px; transform: rotate(135deg); }
        #hamburger-btn.open span:nth-child(2) { opacity: 0; }
        #hamburger-btn.open span:nth-child(3) { top: 11px; transform: rotate(-135deg); }
        .avatar-upload-label { cursor: pointer; }
        .avatar-upload-label:hover .absolute { opacity: 1; }
        .stat-card { background-color: rgba(255,255,255,0.03); border: 1px solid var(--border-color); }
        #chat-widget-container { position: fixed; bottom: 20px; right: 20px; z-index: 1000; }
        #chat-bubble { width: 60px; height: 60px; background: linear-gradient(45deg, var(--accent-purple), var(--accent-pink)); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 4px 20px rgba(0,0,0,0.3); transition: transform 0.3s ease, opacity 0.3s ease; }
        #chat-bubble:hover { transform: scale(1.1); }
        #chat-window { position: absolute; bottom: 80px; right: 0; width: 350px; height: 500px; background-color: var(--card-dark); border: 1px solid var(--border-color); border-radius: 1rem; overflow: hidden; display: flex; flex-direction: column; box-shadow: 0 10px 40px rgba(0,0,0,0.4); transform-origin: bottom right; opacity: 0; transform: translateY(20px) scale(0.95); transition: opacity 0.3s ease, transform 0.3s ease; pointer-events: none; }
        #chat-window.chat-open { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }
        .chat-message { max-width: 80%; padding: 10px 15px; border-radius: 18px; word-wrap: break-word; }
        .user-message { background: linear-gradient(90deg, var(--accent-purple), var(--accent-pink)); color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
        .ai-message { background-color: rgba(255,255,255,0.05); color: var(--text-muted); align-self: flex-start; border-bottom-left-radius: 4px; }
        #chat-history::-webkit-scrollbar { width: 4px; }
        #chat-history::-webkit-scrollbar-thumb { background: var(--accent-purple); border-radius: 2px; }
    </style>
</head>
<body class="overflow-x-hidden">

    <header class="sticky top-0 z-50 bg-opacity-80 bg-[var(--bg-dark)] backdrop-blur-lg border-b border-white/10">
        <nav class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <a href="#" id="home-link" class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-[var(--accent-purple)] to-[var(--accent-pink)] rounded-lg flex items-center justify-center">
                        <svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M24 44C24 44 6 34 6 21V10L24 4L42 10V21C42 34 24 44 24 44Z" stroke="white" stroke-width="3"/><path d="M16 23 H32 M16 23 L14 16 L19 18 L24 14 L29 18 L34 16 L32 23 Z" stroke="#FFFFFF" stroke-width="2.5" fill="none"/></svg>
                    </div>
                    <span class="text-xl font-bold font-['Poppins'] text-white">AFEF Token</span>
                </a>
                <div id="main-nav-links" class="hidden md:flex items-center gap-8 text-sm font-semibold text-gray-300">
                    <a href="#about" class="hover:text-white transition-colors">About</a>
                    <a href="#tokenomics" class="hover:text-white transition-colors">Tokenomics</a>
                    <a href="#roadmap" class="hover:text-white transition-colors">Roadmap</a>
                    <a href="#airdrop" class="hover:text-white transition-colors">Airdrop</a>
                    <a href="#news" class="hover:text-white transition-colors">News</a>
                    <a href="#contract" class="hover:text-white transition-colors">Contract</a>
                </div>
                <div class="flex items-center gap-4">
                    <div id="auth-ui" class="hidden md:block">
                        <button class="login-trigger btn-secondary py-2 px-4 text-sm">Login</button>
                        <div id="user-profile" class="hidden items-center gap-3 relative group">
                            <span id="user-identifier" class="text-sm font-semibold hidden sm:block"></span>
                            <img id="user-avatar" class="w-8 h-8 rounded-full border-2 border-[var(--accent-purple)]" src="" alt="Avatar">
                            <div class="absolute top-full right-0 mt-2 w-48 bg-[var(--card-dark)] border border-[var(--border-color)] rounded-lg shadow-lg opacity-0 pointer-events-none group-hover:opacity-100 group-hover:pointer-events-auto transition-opacity">
                                <a href="#" id="btn-dashboard" class="block px-4 py-2 text-sm text-gray-300 hover:bg-white/5 rounded-t-lg">Go to Dashboard</a>
                                <a href="#" id="btn-logout" class="block px-4 py-2 text-sm text-gray-300 hover:bg-white/5 rounded-b-lg">Logout</a>
                            </div>
                        </div>
                    </div>
                    <button id="hamburger-btn" class="md:hidden text-white z-50" aria-label="Open menu"><span></span><span></span><span></span></button>
                </div>
            </div>
        </nav>
        <div id="mobile-menu" class="hidden md:hidden bg-[var(--card-dark)]/90 backdrop-blur-md container mx-auto rounded-xl p-4 text-center">
            <a href="#about" class="mobile-menu-link block py-3 text-gray-300 hover:text-white text-lg">About</a>
            <a href="#tokenomics" class="mobile-menu-link block py-3 text-gray-300 hover:text-white text-lg">Tokenomics</a>
            <a href="#roadmap" class="mobile-menu-link block py-3 text-gray-300 hover:text-white text-lg">Roadmap</a>
            <a href="#airdrop" class="mobile-menu-link block py-3 text-gray-300 hover:text-white text-lg">Airdrop</a>
            <a href="#news" class="mobile-menu-link block py-3 text-gray-300 hover:text-white text-lg">News</a>
            <a href="#contract" class="mobile-menu-link block py-3 text-gray-300 hover:text-white text-lg">Contract</a>
            <div id="mobile-auth-ui" class="mt-4 border-t border-white/10 pt-4"></div>
        </div>
    </header>

    <div id="page-content">
        <main id="main-content" class="container mx-auto px-6 py-16 space-y-24 md:space-y-32">
             <section class="relative text-center pt-16 md:pt-24">
                 <div class="absolute inset-0 -z-10 overflow-hidden"><div class="absolute top-0 left-1/2 -translate-x-1/2 w-[600px] h-[600px] bg-gradient-to-tr from-[var(--accent-purple)] to-[var(--accent-pink)] opacity-20 rounded-full filter blur-3xl"></div></div>
                 <h1 class="text-4xl md:text-6xl font-bold text-white leading-tight tracking-tight mb-4">The New Standard for<br>Community-Driven Tokens</h1>
                 <p class="max-w-2xl mx-auto text-lg text-text-muted mb-8">AFEF combines secure authentication with decentralized principles to create a trustworthy ecosystem for everyone.</p>
                 <button class="login-trigger btn-primary py-3 px-8 text-lg">Get Started</button>
             </section>
             
             <section id="about" class="pt-16">
                 <h2 class="text-3xl font-bold text-center mb-12 text-white">About AFEF Token</h2>
                 <div class="auth0-card p-8 md:p-12 text-center max-w-4xl mx-auto">
                     <i data-lucide="shield-check" class="w-16 h-16 mx-auto text-[var(--accent-purple)] mb-6"></i>
                     <p class="text-text-muted leading-relaxed">AFEF, symbolized by the shield and crown, represents a new standard in decentralized finance. Our core mission is to create a secure, community-governed ecosystem where every member has a voice. We believe in fair launches, transparent tokenomics, and building a project with true long-term utility and value. Join us in forging a new dynasty in the world of crypto.</p>
                 </div>
             </section>

             <section id="tokenomics" class="pt-16">
                 <h2 class="text-3xl font-bold text-center mb-12 text-white">Tokenomics</h2>
                 <div class="auth0-card p-8 md:p-12 max-w-5xl mx-auto flex flex-col md:flex-row items-center gap-12">
                     <div class="w-full md:w-1/3 flex justify-center"><div style="width: 200px; height: 200px; border-radius: 50%; background-image: conic-gradient(#6A35FF 0% 40%, #E43A8A 40% 70%, #FFFFFF 70% 90%, #A0AEC0 90% 100%);"></div></div>
                     <div class="w-full md:w-2/3 grid grid-cols-2 gap-x-8 gap-y-6 text-left">
                         <div class="flex items-center"><div class="w-4 h-4 rounded-full bg-[var(--accent-purple)] mr-3"></div><div><p class="font-bold text-lg">Liquidity Pool</p><p class="text-text-muted">40%</p></div></div>
                         <div class="flex items-center"><div class="w-4 h-4 rounded-full bg-[var(--accent-pink)] mr-3"></div><div><p class="font-bold text-lg">Airdrop & Community</p><p class="text-text-muted">30%</p></div></div>
                         <div class="flex items-center"><div class="w-4 h-4 rounded-full bg-gray-200 mr-3"></div><div><p class="font-bold text-lg">Team & Advisors</p><p class="text-text-muted">20%</p></div></div>
                         <div class="flex items-center"><div class="w-4 h-4 rounded-full bg-gray-500 mr-3"></div><div><p class="font-bold text-lg">Marketing & Treasury</p><p class="text-text-muted">10%</p></div></div>
                     </div>
                 </div>
             </section>

             <section id="roadmap" class="pt-16">
                  <h2 class="text-3xl font-bold text-center mb-16 text-white">Our Roadmap</h2>
                  <div class="relative max-w-3xl mx-auto">
                       <div class="absolute left-1/2 h-full w-0.5 bg-white/10 transform -translate-x-1/2"></div>
                       <div class="relative mb-8 flex justify-between items-center w-full">
                           <div class="w-1/2 pr-8 text-right"><div class="auth0-card p-4"><strong>Phase 1:</strong> Project Launch & Airdrop</div></div>
                           <div class="absolute left-1/2 transform -translate-x-1/2 w-5 h-5 bg-[var(--accent-purple)] rounded-full border-4 border-[var(--bg-dark)]"></div>
                       </div>
                       <div class="relative mb-8 flex justify-between items-center w-full flex-row-reverse">
                           <div class="w-1/2 pl-8 text-left"><div class="auth0-card p-4"><strong>Phase 2:</strong> CEX Listings & Partnerships</div></div>
                           <div class="absolute left-1/2 transform -translate-x-1/2 w-5 h-5 bg-[var(--accent-purple)] rounded-full border-4 border-[var(--bg-dark)]"></div>
                       </div>
                        <div class="relative mb-8 flex justify-between items-center w-full">
                           <div class="w-1/2 pr-8 text-right"><div class="auth0-card p-4"><strong>Phase 3:</strong> Utility Development (Staking)</div></div>
                           <div class="absolute left-1/2 transform -translate-x-1/2 w-5 h-5 bg-[var(--accent-purple)] rounded-full border-4 border-[var(--bg-dark)]"></div>
                       </div>
                  </div>
             </section>

             <section id="airdrop" class="pt-16">
                  <h2 class="text-3xl font-bold text-center mb-12 text-white">Community Airdrop</h2>
                  <div class="auth0-card p-8 md:p-12 max-w-2xl mx-auto text-center">
                       <i data-lucide="gift" class="w-16 h-16 mx-auto text-[var(--accent-pink)] mb-6"></i>
                       <h3 class="text-2xl font-bold mb-4">Claim Your Stake</h3>
                       <p class="text-text-muted mb-8">Login to check your eligibility for the AFEF airdrop.</p>
                       <button class="login-trigger btn-primary py-3 px-8">Login to Check</button>
                  </div>
             </section>
             
             <section id="news" class="pt-16">
                 <h2 class="text-3xl font-bold text-center mb-12 text-white">Latest News & Updates</h2>
                 <div class="max-w-4xl mx-auto grid md:grid-cols-2 gap-8">
                     <div class="auth0-card p-8">
                         <i data-lucide="shield-check" class="w-12 h-12 text-[var(--accent-purple)] mb-4"></i>
                         <h3 class="text-xl font-bold mb-3">Security First: Audit Discussions Underway</h3>
                         <p class="text-text-muted leading-relaxed">To ensure the utmost security and transparency for our community, we have initiated discussions with several leading blockchain security firms to conduct a comprehensive audit of the AFEF smart contract. We are committed to upholding the highest standards of chain security.</p>
                     </div>
                     <div class="auth0-card p-8">
                         <i data-lucide="database-zap" class="w-12 h-12 text-[var(--accent-pink)] mb-4"></i>
                         <h3 class="text-xl font-bold mb-3">Fortifying the Ecosystem</h3>
                         <p class="text-text-muted leading-relaxed">Our development team is implementing multi-layered security protocols to safeguard the AFEF ecosystem. Ensuring the integrity of the chain and protecting our holders' assets is our top priority as we approach our next milestones.</p>
                     </div>
                 </div>
             </section>

             <section id="contract" class="pt-16">
                  <h2 class="text-3xl font-bold text-center mb-12 text-white">Official Contract</h2>
                  <div class="auth0-card p-8 max-w-4xl mx-auto text-center">
                       <p class="text-text-muted mb-2">Etherscan Contract Address:</p>
                       <div class="flex items-center justify-center bg-black/50 p-3 rounded-lg mb-6 max-w-md mx-auto">
                           <p id="contract-address" class="font-mono text-sm break-all mr-4">0x367a584a928b641330E8B20e7C4739675741f40d</p>
                           <button id="copy-address-btn" title="Copy Address"><i data-lucide="copy" class="w-5 h-5 text-gray-400 hover:text-white"></i></button>
                       </div>
                       <a href="https://etherscan.io/address/0x367a584a928b641330E8B20e7C4739675741f40d" target="_blank" rel="noopener noreferrer" class="inline-block btn-secondary py-3 px-6">View on Etherscan</a>
                  </div>
             </section>
        </main>
        
        <div id="dashboard" class="hidden container mx-auto px-6 py-16">
            <div id="dashboard-main">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                    <h1 class="text-3xl md:text-4xl font-bold text-white">My Dashboard</h1>
                    <button id="go-to-settings-btn" class="btn-secondary text-sm flex items-center gap-2 px-4 py-2"><i data-lucide="settings" class="w-4 h-4"></i> Settings</button>
                </div>
                 <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="stat-card p-6 rounded-lg">
                        <div class="flex items-center text-text-muted mb-2"><i data-lucide="wallet" class="w-4 h-4 mr-2"></i><span>AFEF Token Balance</span></div>
                        <p id="dashboard-balance" class="text-3xl font-bold text-white">0.00</p>
                    </div>
                    <div class="stat-card p-6 rounded-lg">
                        <div class="flex items-center text-text-muted mb-2"><i data-lucide="gift" class="w-4 h-4 mr-2"></i><span>Airdrop Status</span></div>
                        <p id="dashboard-airdrop" class="text-3xl font-bold text-white">Not Eligible</p>
                    </div>
                    <div class="stat-card p-6 rounded-lg">
                        <div class="flex items-center text-text-muted mb-2"><i data-lucide="calendar" class="w-4 h-4 mr-2"></i><span>Member Since</span></div>
                        <p id="dashboard-member-since" class="text-3xl font-bold text-white">-</p>
                    </div>
                </div>
                <div class="auth0-card p-8 mt-8">
                    <h2 class="text-2xl font-bold text-white">Welcome Back!</h2>
                    <p class="text-text-muted mt-2">This is your personal dashboard. More features will be added soon!</p>
                </div>
            </div>
            <div id="dashboard-settings" class="hidden">
                <div class="flex items-center mb-8 gap-4">
                    <button id="back-to-dashboard-btn" class="btn-secondary p-2"><i data-lucide="arrow-left" class="w-5 h-5"></i></button>
                    <h1 class="text-3xl md:text-4xl font-bold text-white">Profile Settings</h1>
                </div>
                <div class="auth0-card p-8 max-w-2xl mx-auto">
                    <div class="space-y-6">
                        <div>
                            <label for="displayName" class="block text-sm font-medium text-text-muted mb-2">Display Name</label>
                            <input type="text" id="displayName" placeholder="Enter your name" class="w-full bg-black/50 text-white px-4 py-3 rounded-lg border border-[var(--border-color)] focus:border-[var(--accent-purple)] focus:ring-0 transition-colors">
                        </div>
                        <div>
                            <label for="displayEmail" class="block text-sm font-medium text-text-muted mb-2">Email Address</label>
                            <input type="email" id="displayEmail" class="w-full bg-black/50 text-gray-400 px-4 py-3 rounded-lg border border-[var(--border-color)]" disabled>
                        </div>
                        <button id="save-profile-btn" class="w-full btn-primary py-3">Save Changes</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <footer class="py-12 border-t border-white/10 mt-24">
       <div class="container mx-auto px-6 text-center">
            <div class="flex justify-center space-x-6 mb-6">
                <a href="https://x.com/afeftoken?s=21" target="_blank" rel="noopener noreferrer" class="text-text-muted hover:text-[var(--accent-purple)] transition"><i data-lucide="twitter" class="w-6 h-6"></i></a>
                <a href="https://t.me/afeftoken" target="_blank" rel="noopener noreferrer" class="text-text-muted hover:text-[var(--accent-purple)] transition"><i data-lucide="send" class="w-6 h-6"></i></a>
                <a href="mailto:empiresfantoken@outlook.com" class="text-text-muted hover:text-[var(--accent-purple)] transition"><i data-lucide="mail" class="w-6 h-6"></i></a>
            </div>
            <p class="text-text-muted text-sm">&copy; <span id="year"></span> AFEF Token. All rights reserved.</p>
       </div>
    </footer>

    <div id="login-modal" class="fixed inset-0 z-[100] items-center justify-center bg-black/80 hidden">
        <div class="auth0-card w-full max-w-md m-4 relative">
             <button id="close-modal-btn" class="absolute top-4 right-4 text-gray-400 hover:text-white" aria-label="Close modal"><i data-lucide="x" class="w-6 h-6"></i></button>
            <div class="p-8">
                <div id="login-options">
                    <h2 class="text-2xl font-bold text-center mb-6">Welcome</h2>
                    <p class="text-center text-text-muted mb-8">Choose your preferred method to continue.</p>
                    <div class="space-y-4">
                        <button id="connect-metamask-btn" class="w-full flex items-center justify-center gap-3 py-3 px-4 btn-secondary"><img src="https://upload.wikimedia.org/wikipedia/commons/3/36/MetaMask_Fox.svg" class="w-6 h-6" alt="MetaMask Logo"><span class="font-semibold">Connect with MetaMask</span></button>
                        <button id="continue-with-email-btn" class="w-full flex items-center justify-center gap-3 py-3 px-4 btn-secondary"><i data-lucide="mail" class="w-6 h-6"></i><span class="font-semibold">Continue with Email</span></button>
                    </div>
                </div>
                <div id="email-login-view" class="hidden">
                    <button id="back-to-options-btn" class="text-gray-400 hover:text-white mb-4 flex items-center gap-2 text-sm"><i data-lucide="arrow-left" class="w-4 h-4"></i> Back</button>
                    <h2 class="text-2xl font-bold text-center mb-6">Enter Your Email</h2>
                     <div class="flex flex-col sm:flex-row gap-3">
                         <input type="email" id="email-input" placeholder="your@email.com" class="w-full bg-black/50 text-white px-4 py-3 rounded-lg border border-[var(--border-color)] focus:border-[var(--accent-purple)] focus:ring-0 transition-colors">
                         <button id="btn-passwordless-login" class="btn-primary py-3 px-6 whitespace-nowrap">Send Code</button>
                     </div>
                    <p class="text-xs text-text-muted mt-4 text-center">We'll send a verification code to your email.</p>
                </div>
                <div id="email-verify-view" class="hidden">
                    <button id="back-to-email-btn" class="text-gray-400 hover:text-white mb-4 flex items-center gap-2 text-sm"><i data-lucide="arrow-left" class="w-4 h-4"></i> Back</button>
                    <h2 class="text-2xl font-bold text-center mb-2">Check Your Email</h2>
                    <p class="text-center text-text-muted mb-6 text-sm">We sent a verification code to <br><strong id="verify-email-display"></strong></p>
                    <div class="flex flex-col gap-3">
                        <input type="text" id="code-input" placeholder="_ _ _ _ _ _" maxlength="6" class="w-full bg-black/50 text-white px-4 py-3 rounded-lg border border-[var(--border-color)] focus:border-[var(--accent-purple)] focus:ring-0 transition-colors text-center text-2xl tracking-[0.5em]">
                        <button id="btn-verify-code" class="btn-primary py-3 px-6">Verify Code</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="toast" class="fixed bottom-5 right-5 bg-gradient-to-r from-[var(--accent-purple)] to-[var(--accent-pink)] text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300">
        Message here
    </div>

    <div id="chat-widget-container">
        <div id="chat-window" class="transition-transform duration-300 ease-in-out">
            <div class="p-4 bg-opacity-80 bg-[var(--card-dark)] backdrop-blur-lg border-b border-[var(--border-color)] flex justify-between items-center">
                <h3 class="font-bold text-lg">AFEF Support</h3>
                <button id="close-chat-btn" class="text-gray-400 hover:text-white">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            <div id="chat-history" class="flex-1 p-4 flex flex-col gap-4 overflow-y-auto">
                <div class="ai-message chat-message">
                    Hello! I'm the AFEF Token Support assistant. How can I help you with our project today?
                </div>
            </div>
            <div class="p-4 border-t border-[var(--border-color)]">
                <div class="flex gap-2">
                    <input type="text" id="chat-input" placeholder="Type your message..." class="w-full bg-black/50 text-white px-4 py-2 rounded-lg border border-[var(--border-color)] focus:border-[var(--accent-purple)] focus:ring-0 transition-colors">
                    <button id="chat-send-btn" class="btn-primary p-3 flex items-center justify-center">
                        <i data-lucide="send" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
        </div>
        <div id="chat-bubble">
            <i data-lucide="message-circle" class="w-8 h-8 text-white"></i>
        </div>
    </div>
    
    <script>
        // --- App State & Config ---
        let userProfile;
        let accessToken;
        let idToken;
        let expiresAt;
        let userEmailForVerification;

        const auth0Config = {
            domain: "dev-z8y2rl3nibo7ss8j.eu.auth0.com",
            clientId: "flAocvN0OThbj3JL6ydOBjUFuUw856kk", 
            redirectUri: 
            scope: 'openid profile email',
            responseType: 'token id_token'
        };

        const webAuth = new auth0.WebAuth({
            domain: auth0Config.domain,
            clientID: auth0Config.clientId,
            redirectUri: window.location.origin,
            responseType: auth0Config.responseType,
            scope: auth0Config.scope
        });

        // --- View Management & UI Updates ---
        const mainContent = document.getElementById('main-content');
        const dashboard = document.getElementById('dashboard');
        const dashboardMain = document.getElementById('dashboard-main');
        const dashboardSettings = document.getElementById('dashboard-settings');

        function showView(view) {
            mainContent.style.display = 'none';
            dashboard.style.display = 'none';
            if (view === 'main') mainContent.style.display = 'block';
            if (view === 'dashboard') dashboard.style.display = 'block';
            window.scrollTo(0, 0);
        };

        function showDashboardView(view) {
            dashboardMain.style.display = 'none';
            dashboardSettings.style.display = 'none';
            if(view === 'main') dashboardMain.style.display = 'block';
            if(view === 'settings') dashboardSettings.style.display = 'block';
        };

        function updateUI() {
            const isAuthenticated = IsAuthenticated();
            const userProfileDiv = document.getElementById('user-profile');
            const authUI = document.getElementById('auth-ui');
            const mobileAuthUI = document.getElementById('mobile-auth-ui');

            if (isAuthenticated && userProfile) { // Added userProfile check
                authUI.querySelector('.login-trigger').style.display = 'none';
                userProfileDiv.style.display = 'flex';
                
                document.getElementById('user-avatar').src = userProfile.picture || `https://placehold.co/40x40/6A35FF/FFFFFF?text=${(userProfile.name || userProfile.email || 'A')[0].toUpperCase()}`;
                document.getElementById('user-identifier').textContent = userProfile.name || userProfile.email;
                if(document.getElementById('displayEmail')) document.getElementById('displayEmail').value = userProfile.email;
                if(document.getElementById('displayName')) document.getElementById('displayName').value = userProfile.name || '';

                mobileAuthUI.innerHTML = `<button id="btn-logout-mobile" class="w-full btn-secondary py-2">Logout</button>`;
                document.getElementById('btn-logout-mobile').addEventListener('click', logout);
            } else {
                authUI.querySelector('.login-trigger').style.display = 'block';
                userProfileDiv.style.display = 'none';
                mobileAuthUI.innerHTML = `<button class="login-trigger btn-primary w-full py-2">Login / Register</button>`;
                const mobileLoginTrigger = mobileAuthUI.querySelector('.login-trigger');
                if (mobileLoginTrigger) {
                    mobileLoginTrigger.addEventListener('click', openLoginModal);
                }
            }
            document.querySelectorAll('.login-trigger').forEach(btn => {
                const parentAuthUI = btn.closest('#auth-ui, #mobile-auth-ui');
                if (parentAuthUI) {
                    btn.style.display = isAuthenticated ? 'none' : 'block';
                }
            });
        };
        
        // --- Auth Functions ---
        function setSession(authResult) {
            expiresAt = (authResult.expiresIn * 1000) + new Date().getTime();
            accessToken = authResult.accessToken;
            idToken = authResult.idToken;
            userProfile = authResult.idTokenPayload;
        }

        function IsAuthenticated() {
            return expiresAt && new Date().getTime() < expiresAt;
        }

        function handleAuthentication() {
             webAuth.checkSession({}, (err, authResult) => {
                 if (authResult && authResult.accessToken && authResult.idToken) {
                     setSession(authResult);
                     showView('dashboard');
                 } else if (err) {
                     console.log("Could not get a new token", err);
                     showView('main');
                 }
                  updateUI();
             });
        }
        
        function startPasswordlessLogin() {
            const email = document.getElementById('email-input').value;
            if (!/^\S+@\S+\.\S+$/.test(email)) {
                showToast('Please enter a valid email address.', 'error');
                return;
            }
            userEmailForVerification = email; 

            const button = document.getElementById('btn-passwordless-login');
            button.disabled = true;
            button.textContent = "Sending...";

            webAuth.passwordlessStart({
                connection: 'email',
                send: 'code',
                email: email
            }, (err, res) => {
                button.disabled = false;
                button.textContent = "Send Code";
                if (err) {
                    console.error(err);
                    showToast(err.description || 'Failed to send code. Please try again.', 'error');
                } else {
                    document.getElementById('verify-email-display').textContent = email;
                    showLoginModalView('verify');
                }
            });
        };

        function verifyCode() {
            const code = document.getElementById('code-input').value;
             if (!code || code.length < 6) {
                 showToast('Please enter the 6-digit code.', 'error');
                 return;
             }
            const button = document.getElementById('btn-verify-code');
            button.disabled = true;
            button.textContent = "Verifying...";
            
            webAuth.passwordlessLogin({
                connection: 'email',
                email: userEmailForVerification,
                verificationCode: code
            }, (err, authResult) => {
                button.disabled = false;
                button.textContent = "Verify Code";
                if (err) {
                    console.error(err);
                    showToast(err.description || 'Invalid code. Please try again.', 'error');
                } else {
                    setSession(authResult);
                    closeLoginModal();
                    showView('dashboard');
                    updateUI();
                }
            });
        }

        function logout() {
            accessToken = null;
            idToken = null;
            expiresAt = null;
            userProfile = null;
            webAuth.logout({
                returnTo: window.location.origin,
                clientID: auth0Config.clientId
            });
        };

        // --- Modal & View Management ---
        const loginModal = document.getElementById('login-modal');
        const loginViews = {
            options: document.getElementById('login-options'),
            email: document.getElementById('email-login-view'),
            verify: document.getElementById('email-verify-view')
        };
        
        function openLoginModal() { loginModal.style.display = 'flex'; showLoginModalView('options'); }
        function closeLoginModal() { loginModal.style.display = 'none'; }

        function showLoginModalView(viewName) {
            Object.values(loginViews).forEach(view => view.classList.add('hidden'));
            if (loginViews[viewName]) {
                loginViews[viewName].classList.remove('hidden');
            }
        }
        
        function closeMobileMenu() {
            document.getElementById('mobile-menu').classList.add('hidden');
            document.getElementById('hamburger-btn').classList.remove('open');
        }
        
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.remove('from-red-500', 'to-red-600', 'from-[var(--accent-purple)]', 'to-[var(--accent-pink)]');
            
            if (type === 'error') {
                 toast.classList.add('from-red-500', 'to-red-600');
            } else {
                 toast.classList.add('from-[var(--accent-purple)]', 'to-[var(--accent-pink)]');
            }
            toast.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => { toast.classList.add('translate-y-20', 'opacity-0'); }, 3000);
        }
        
        // --- EVENT LISTENERS ---
        function setupEventListeners() {
            document.querySelectorAll('.login-trigger').forEach(btn => btn.addEventListener('click', openLoginModal));
            document.getElementById('close-modal-btn').addEventListener('click', closeLoginModal);
            loginModal.addEventListener('click', (e) => { if(e.target === loginModal) closeLoginModal(); });
            
            document.getElementById('continue-with-email-btn').addEventListener('click', () => showLoginModalView('email'));
            document.getElementById('back-to-options-btn').addEventListener('click', () => showLoginModalView('options'));
            document.getElementById('back-to-email-btn').addEventListener('click', () => showLoginModalView('email'));

            document.getElementById('connect-metamask-btn').addEventListener('click', () => showToast('MetaMask integration coming soon!'));
            document.getElementById('btn-passwordless-login').addEventListener('click', startPasswordlessLogin);
            document.getElementById('btn-verify-code').addEventListener('click', verifyCode);
            document.getElementById('btn-logout').addEventListener('click', logout);

            const hamburgerBtn = document.getElementById('hamburger-btn');
            const mobileMenu = document.getElementById('mobile-menu');
            hamburgerBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                mobileMenu.classList.toggle('hidden');
                hamburgerBtn.classList.toggle('open');
            });
            document.querySelectorAll('.mobile-menu-link').forEach(link => link.addEventListener('click', closeMobileMenu));
            
            document.getElementById('home-link').addEventListener('click', (e) => { e.preventDefault(); showView(IsAuthenticated() ? 'dashboard' : 'main'); });
            document.getElementById('btn-dashboard').addEventListener('click', (e) => { e.preventDefault(); showView('dashboard'); showDashboardView('main'); closeMobileMenu();});
            document.getElementById('go-to-settings-btn').addEventListener('click', () => showDashboardView('settings'));
            document.getElementById('back-to-dashboard-btn').addEventListener('click', () => showDashboardView('main'));
            
            document.getElementById('copy-address-btn').addEventListener('click', () => {
                navigator.clipboard.writeText(document.getElementById('contract-address').textContent)
                    .then(() => showToast('Address copied to clipboard!'));
            });
            document.getElementById('year').textContent = new Date().getFullYear();
        }

        function setupChatEventListeners() {
            const chatBubble = document.getElementById('chat-bubble');
            const chatWindow = document.getElementById('chat-window');
            const closeChatBtn = document.getElementById('close-chat-btn');
            const chatSendBtn = document.getElementById('chat-send-btn');
            const chatInput = document.getElementById('chat-input');
            const chatHistory = document.getElementById('chat-history');

            chatBubble.addEventListener('click', () => {
                chatWindow.classList.add('chat-open');
                lucide.createIcons();
            });

            closeChatBtn.addEventListener('click', () => {
                chatWindow.classList.remove('chat-open');
            });

            const addMessage = (message, sender) => {
                const messageDiv = document.createElement('div');
                messageDiv.className = `chat-message ${sender === 'user' ? 'user-message' : 'ai-message'}`;
                messageDiv.textContent = message;
                chatHistory.appendChild(messageDiv);
                chatHistory.scrollTop = chatHistory.scrollHeight;
            };
            
            const showTypingIndicator = () => {
                const typingDiv = document.createElement('div');
                typingDiv.id = 'typing-indicator';
                typingDiv.className = 'ai-message chat-message flex items-center gap-2';
                typingDiv.innerHTML = `<div class="w-2 h-2 bg-gray-400 rounded-full animate-pulse"></div><div class="w-2 h-2 bg-gray-400 rounded-full animate-pulse" style="animation-delay: 0.2s;"></div><div class="w-2 h-2 bg-gray-400 rounded-full animate-pulse" style="animation-delay: 0.4s;"></div>`;
                chatHistory.appendChild(typingDiv);
                chatHistory.scrollTop = chatHistory.scrollHeight;
            };

            const removeTypingIndicator = () => {
                const indicator = document.getElementById('typing-indicator');
                if (indicator) { indicator.remove(); }
            };
            
            const sendMessageToAI = async () => {
                const prompt = chatInput.value.trim();
                if (!prompt) return;

                addMessage(prompt, 'user');
                chatInput.value = '';
                chatSendBtn.disabled = true;
                showTypingIndicator();

                try {
                    const response = await fetch('/.netlify/functions/gemini-proxy', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ prompt: prompt }),
                    });
                    
                    removeTypingIndicator();
                    if (!response.ok) { throw new Error('Network response was not ok.'); }
                    const data = await response.json();
                    addMessage(data.response, 'ai');

                } catch (error) {
                    console.error('Error:', error);
                    removeTypingIndicator();
                    addMessage('Sorry, something went wrong. Please try again.', 'ai');
                } finally {
                     chatSendBtn.disabled = false;
                }
            };

            chatSendBtn.addEventListener('click', sendMessageToAI);
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') { sendMessageToAI(); }
            });
        }

        // --- INITIALIZE APP ---
        window.onload = () => {
            handleAuthentication();
            lucide.createIcons();
            setupEventListeners();
            setupChatEventListeners();
        };
    </script>
</body>
</html>

